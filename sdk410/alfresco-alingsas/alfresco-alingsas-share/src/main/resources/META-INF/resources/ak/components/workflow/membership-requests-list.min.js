'use strict';(function(){var r=YAHOO.util.Dom,e=Alfresco.util.encodeHTML,f=Alfresco.util.siteURL;Alfresco.component.MembershipRequests=function(b){Alfresco.component.MembershipRequests.superclass.constructor.call(this,"Alfresco.component.MembershipRequests",b,"button menu container datasource datatable paginator json history".split(" "));YAHOO.Bubbling.on("filterChanged",this.onFilterChanged,this);return this};YAHOO.extend(Alfresco.component.MembershipRequests,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.component.MembershipRequests,
Alfresco.action.WorkflowActions);YAHOO.lang.augmentObject(Alfresco.component.MembershipRequests.prototype,{options:{hiddenTaskTypes:[],filterParameters:[],maxItems:50},onReady:function(){var b=Alfresco.constants.PROXY_URI+"api/task-instances?authority=GROUP_site_"+Alfresco.constants.SITE+"_SiteManager&properties=bpm_priority,bpm_status,bpm_dueDate,bpm_description&exclude="+this.options.hiddenTaskTypes.join(",")+"&skipCount=0&maxItems=50";this.widgets.pagingDataTable=new Alfresco.util.DataTable({dataTable:{container:this.id+
"-tasks",columnDefinitions:[{key:"id",sortable:!1,formatter:this.bind(this.renderCellIcons),width:40},{key:"title",sortable:!1,formatter:this.bind(this.renderCellTaskInfo)},{key:"name",sortable:!1,formatter:this.bind(this.renderCellActions),width:200}],config:{MSG_EMPTY:this.msg("message.noTasks")}},dataSource:{url:b,defaultFilter:{filterId:"workflows.active"},filterResolver:this.bind(function(a){return this.createFilterURLParameters(a,this.options.filterParameters)})},paginator:{config:{containers:[this.id+
"-paginator"],rowsPerPage:this.options.maxItems}}})},onFilterChanged:function(b,a){b=Alfresco.util.cleanBubblingObject(a[1]);r.get(this.id+"-filterTitle").innerHTML=e(this.msg("filter."+b.filterId+(b.filterData?"."+b.filterData:""),b.filterData))},renderCellIcons:function(b,a,c,g){c={1:"high",2:"medium",3:"low"}[a.getData("properties").bpm_priority+""];a=a.getData("isPooled");c='<img src="'+Alfresco.constants.URL_RESCONTEXT+"components/images/priority-"+c+'-16.png" title="'+this.msg("label.priority",
this.msg("priority."+c))+'"/>';a&&(c+='<br/><img src="'+Alfresco.constants.URL_RESCONTEXT+'components/images/pooled-task-16.png" title="'+this.msg("label.pooledTask")+'"/>');b.innerHTML=c},renderCellTaskInfo:function(b,a,c,g){var h=a.getData("id"),k=e(a.getData("properties").bpm_description),n=(c=a.getData("properties").bpm_dueDate)?Alfresco.util.fromISO8601(c):null,d=a.getData("workflowInstance"),p=d.startDate?Alfresco.util.fromISO8601(d.startDate):null;c=e(a.getData("title"));g=e(a.getData("properties").bpm_status);
var q=a.getData("owner"),t=e(a.getData("description")),l;d.initiator&&(l=e(d.initiator.firstName+" "+d.initiator.lastName+" ("+d.initiator.userName+")"));var m=a.getData();m.propertyLabels&&Alfresco.util.isValueSet(m.propertyLabels.bpm_status,!1)&&(g=m.propertyLabels.bpm_status);k==c&&(k=this.msg("workflow.no_message"));a='<h3><a href="'+(a.getData("isEditable")?f("task-edit?taskId="+h+"&referrer=tasks&myTasksLinkBack=true")+'" class="theme-color-1" title="'+this.msg("link.editTask"):f("task-details?taskId="+
h+"&referrer=tasks&myTasksLinkBack=true")+'" class="theme-color-1" title="'+this.msg("link.viewTask"))+'" style="font-weight: bold; text-decoration: underline">'+k+'</a></h3><div class="due"><label>'+(this.msg("label.due")+":</label><span>"+(n?Alfresco.util.formatDate(n,"longDate"):this.msg("label.none"))+"</span></div>");a+='<div class="started"><label>'+this.msg("label.started")+":</label><span>"+(p?Alfresco.util.formatDate(p,"longDate"):this.msg("label.none"))+"</span></div>";d.isActive||(h=d.endDate?
Alfresco.util.fromISO8601(d.endDate):null,a+='<div class=ended"><label>'+this.msg("label.ended")+":</label><span>"+(h?Alfresco.util.formatDate(h,"longDate"):this.msg("label.none"))+"</span></div>");a+='<div class="status"><label>'+this.msg("label.status")+":</label><span>"+g+"</span></div>";a+='<div class="type"><label>'+this.msg("label.type",c)+":</label><span>"+c+"</span></div>";a+='<div class="description"><label>'+this.msg("label.description")+":</label><span>"+t+"</span></div>";l&&(a+='<div class="initiator"><label>'+
this.msg("label.initiator")+":</label><span>"+l+"</span></div>");q&&q.userName||(a+='<div class="unassigned"><span class="theme-bg-color-5 theme-color-5 unassigned-task">'+this.msg("label.unassignedTask")+"</span></div>");b.innerHTML=a},renderCellActions:function(b,a,c,g){a.getData("isEditable")&&this.createAction(b,this.msg("link.editTask"),"task-edit-link",f("task-edit?taskId="+a.getData("id")+"&referrer=tasks&myTasksLinkBack=true"));this.createAction(b,this.msg("link.viewTask"),"task-view-link",
f("task-details?taskId="+a.getData("id")+"&referrer=tasks&myTasksLinkBack=true"));this.createAction(b,this.msg("link.viewWorkflow"),"workflow-view-link",f("workflow-details?workflowId="+a.getData("workflowInstance").id+"&taskId="+a.getData("id")+"&referrer=tasks&myTasksLinkBack=true"))}},!0)})();

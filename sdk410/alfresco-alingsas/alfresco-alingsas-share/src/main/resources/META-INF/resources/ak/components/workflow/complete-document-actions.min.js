'use strict';(function(){YAHOO.Bubbling.fire("registerAction",{actionName:"onActionCompleteDocumentAction",fn:function(a,h){var b=this,f=a.displayName,g=a.nodeRef,k=a.parent.nodeRef,d=Alfresco.doclib.Actions.prototype.getAction(a,h).params;var c=void 0!=a.jsNode.properties["akdm:documentSecrecy"]?a.jsNode.properties["akdm:documentSecrecy"]:null;var e=null;(e=void 0!=a.location.site)?(e=a.location.site.name,Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions.complete-document.title"),
noEscape:!0,text:this.msg("message.complete-document.message",f),buttons:[{text:this.msg("button.complete-document.completehere"),handler:function(){if(null==c){var l=this;Alfresco.util.PopupManager.getUserInput({title:b.msg("actions.complete-document.missing-secrecy.title"),noEscape:!0,html:b.msg("message.complete-document.missing-secrecy.message",f)+'<select id="complete_document_secrecy_id" name="secrecy"><option value="Offentligt">Offentligt</option><option value="Sekretessbelagt">Sekretessbelagt</option></select>',
value:"Dummy",buttons:[{text:b.msg("button.complete-document.missing-secrecy.ok"),handler:function(){c=document.getElementById("complete_document_secrecy_id").value;this.destroy();l.getButtons()[0]._button.click()}},{text:b.msg("button.cancel"),handler:function(){this.destroy()},isDefault:!0}]})}else null!=c&&(this.destroy(),Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"alingsas/workflow/completedocument/"+d.workflow+"/"+a.jsNode.nodeRef.uri+"/"+c+"/"+e+"/"+k.replace("://","/"),method:Alfresco.util.Ajax.POST,
successCallback:{fn:function(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:b.msg("message.completedocument.success")})},scope:b},failureMessage:b.msg("message.completedocument.failure")}))}},{text:this.msg("button.complete-document.completeother"),handler:function(){this.destroy();null==c?Alfresco.util.PopupManager.displayMessage({text:b.msg("message.completedocument.nosecrecyset")}):location.href="start-workflow?selectedItems="+g+"&startWorkflow="+d.workflow}},
{text:this.msg("button.cancel"),handler:function(){this.destroy()},isDefault:!0}]})):null==c?Alfresco.util.PopupManager.displayMessage({text:b.msg("message.completedocument.nosecrecyset")}):location.href="start-workflow?selectedItems="+g+"&startWorkflow="+d.workflow}})})();

'use strict';(function(){var c=YAHOO.util.Dom;Alfresco.component.StartWorkflow=function(a){Alfresco.component.StartWorkflow.superclass.constructor.call(this,a,["button"]);this.name="Alfresco.component.StartWorkflow";Alfresco.util.ComponentManager.reregister(this);this.options=YAHOO.lang.merge(this.options,Alfresco.component.StartWorkflow.superclass.options);this.destination=this.selectedItems="";this.workflowTypes=[];YAHOO.Bubbling.on("objectFinderReady",this.onObjectFinderReady,this);YAHOO.Bubbling.on("formContentReady",
this.onStartWorkflowFormContentReady,this);return this};YAHOO.extend(Alfresco.component.StartWorkflow,Alfresco.component.ShareFormManager,{options:{selectedItems:"",destination:"",workflowDefinitions:[],startWorkflow:""},onReady:function(){this.widgets.workflowDefinitionMenuButton=Alfresco.util.createYUIButton(this,"workflow-definition-button",this.onWorkflowSelectChange,{label:this.msg("label.selectWorkflowDefinition")+" "+Alfresco.constants.MENU_ARROW_SYMBOL,title:this.msg("title.selectWorkflowDefinition")+
" "+Alfresco.constants.MENU_ARROW_SYMBOL,type:"menu",menu:"workflow-definition-menu"});if(""!=this.options.startWorkflow)for(var a=0;a<this.options.workflowDefinitions.length;a++){var b=this.options.workflowDefinitions[a];if(this.options.startWorkflow==b.name){this.createWorkflow(b);break}}return Alfresco.component.StartWorkflow.superclass.onReady.call(this)},createWorkflow:function(a){this.widgets.workflowDefinitionMenuButton.set("label",a.title+" "+Alfresco.constants.MENU_ARROW_SYMBOL);this.widgets.workflowDefinitionMenuButton.set("title",
a.description);Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"components/form",dataObj:{htmlid:this.id+"-startWorkflowForm-"+Alfresco.util.generateDomId(),itemKind:"workflow",itemId:a.name,mode:"create",submitType:"json",showCaption:!0,formUI:!0,showCancelButton:!0,destination:this.options.destination},successCallback:{fn:this.onWorkflowFormLoaded,scope:this},failureMessage:this.msg("message.failure"),scope:this,execScripts:!0})},onObjectFinderReady:function(a,b){a=b[1].eventGroup;
"assoc_packageItems"==a.options.field&&0==a.eventGroup.indexOf(this.id)&&a.selectItems(this.options.selectedItems)},onWorkflowSelectChange:function(a,b){a=b[1].index;0<=a&&(a=this.options.workflowDefinitions[a],this.widgets.workflowDefinitionMenuButton.set("label",a.title),this.widgets.workflowDefinitionMenuButton.set("title",a.description),Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"components/form",dataObj:{htmlid:this.id+"-startWorkflowForm-"+Alfresco.util.generateDomId(),
itemKind:"workflow",itemId:a.name,mode:"create",submitType:"json",showCaption:!0,formUI:!0,showCancelButton:!0,destination:this.options.destination},successCallback:{fn:this.onWorkflowFormLoaded,scope:this},failureMessage:this.msg("message.failure"),scope:this,execScripts:!0}))},onWorkflowFormLoaded:function(a){var b=c.get(this.id+"-workflowFormContainer");c.addClass(b,"hidden");b.innerHTML=a.serverResponse.responseText},onStartWorkflowFormContentReady:function(a,b){a=c.get(this.id+"-workflowFormContainer");
c.removeClass(a,"hidden")}})})();
